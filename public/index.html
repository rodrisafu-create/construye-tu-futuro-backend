<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Construye tu futuro - Simulador</title>

  <!-- Chart.js (CDN) -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

  <style>
    /* --- Snowball demo --- */
.snowWrap{
  margin-top: 14px;
  padding: 18px;
}
.snowGrid{
  display:grid;
  grid-template-columns: 1fr 1fr;
  gap: 14px;
  align-items: center;
}
.snowLeft h3{ margin: 0 0 8px; }
.snowLeft p{ margin: 0 0 12px; color:#374151; }

.snowControls{
  display:grid;
  grid-template-columns: 1fr;
  gap: 10px;
}
.rangeRow{
  display:flex;
  gap:12px;
  align-items:center;
}
.rangeRow input[type="range"]{
  width:100%;
  accent-color: var(--btn);
}
.rangePill{
  flex:0 0 auto;
  padding: 8px 10px;
  border-radius: 999px;
  border: 1px solid rgba(0,0,0,.12);
  background:#fff;
  font-family: var(--mono);
  font-weight:900;
  font-size: 12px;
}

.snowStats{
  display:grid;
  grid-template-columns: 1fr 1fr;
  gap: 10px;
}
.snowStat{
  border: 1px solid rgba(0,0,0,.10);
  border-radius: 16px;
  padding: 12px;
  background:#fff;
}
.snowStat .k{ font-size: 12px; color:#6b7280; }
.snowStat .v{ margin-top:6px; font-family: var(--mono); font-weight:900; font-size: 18px; }

/* === SNOWBALL: MONTAÑA + BOLA RODANDO === */
.snowStage{
  position: relative;
  width: 100%;
  min-height: 320px;
  background: linear-gradient(180deg,
    rgba(135, 206, 235, 0.22) 0%,
    rgba(135, 206, 235, 0.08) 60%,
    transparent 100%
  );
  border: 1px solid rgba(0,0,0,.10);
  border-radius: 18px;
  overflow: hidden;
}

/* Pendiente / montaña */
.snowSlope{
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  height: 78%;
  background: linear-gradient(135deg,
    rgba(176, 140, 98, 0.14) 0%,
    rgba(176, 140, 98, 0.06) 100%
  );
  clip-path: polygon(0 100%, 0 28%, 100% 100%);
}

/* Línea visual de la pendiente */
.snowSlope::before{
  content: '';
  position: absolute;
  top: 28%;
  left: 0;
  width: 140%;
  height: 2px;
  background: rgba(176, 140, 98, 0.25);
  transform-origin: left top;
  transform: rotate(-32deg);
}

/* Base “nieve” */
.snowGround{
  position: absolute;
  left: 0;
  right: 0;
  bottom: 0;
  height: 26px;
  background: rgba(255,255,255,.75);
  border-top: 1px solid rgba(0,0,0,.08);
}

/* La bola */
.snowBall{
  position: absolute;
  border-radius: 50%;
  background: radial-gradient(
    circle at 35% 35%,
    #ffffff 0%,
    #f8f4f0 30%,
    #e7dfd5 100%
  );
  box-shadow:
    0 10px 25px rgba(0,0,0,.18),
    inset -4px -4px 8px rgba(0,0,0,.06);
  border: 2px solid rgba(255,255,255,.9);

  /* IMPORTANTE: ahora animamos todo (posición + tamaño + rotación) */
  transition: all 0.8s cubic-bezier(0.34, 1.56, 0.64, 1);
}

/* sombra */
.snowBall::after{
  content:'';
  position:absolute;
  bottom:-12px;
  left:50%;
  transform: translateX(-50%);
  width:70%;
  height:8px;
  background: radial-gradient(ellipse, rgba(0,0,0,.15) 0%, transparent 70%);
  border-radius:50%;
}

@media (max-width: 980px){
  .snowStage{ min-height: 280px; }
}

@media (max-width: 980px){
  .snowGrid{ grid-template-columns: 1fr; }
  .snowStage{ min-height: 210px; }
}
    :root{
      --bg:#0b1f3a;
      --panel:#0e2a4e;
      --cream:#f2ece4;
      --text:#0a0a0a;
      --muted:#6b7280;
      --white:#ffffff;
      --btn:#b08c62;
      --btnHover:#c59a6c;
      --ring: rgba(176,140,98,.35);
      --card:#ffffff;
      --border: rgba(0,0,0,.08);
      --shadowSoft: 0 10px 22px rgba(0,0,0,.08);
      --radius: 18px;
      --max: 1180px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:var(--sans);
      color:var(--text);
      background: var(--cream);
      line-height:1.35;
    }
    a{ color:inherit; text-decoration:none; }
    .container{ max-width: var(--max); margin: 0 auto; padding: 0 18px; }

    /* Language overlay */
    .langOverlay{
      position: fixed;
      inset:0;
      background: rgba(11,31,58,.86);
      backdrop-filter: blur(8px);
      display:flex;
      align-items:center;
      justify-content:center;
      z-index: 9999;
      padding: 18px;
    }
    .langCard{
      width: min(560px, 100%);
      background: rgba(255,255,255,.92);
      border: 1px solid rgba(0,0,0,.10);
      border-radius: 22px;
      box-shadow: 0 24px 60px rgba(0,0,0,.35);
      padding: 18px;
    }
    .langCard h2{ margin: 0 0 8px; letter-spacing:-.02em; }
    .langCard p{ margin: 0 0 14px; color:#374151; }
    .langBtns{
      display:grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 10px;
    }
    .langBtn{
      padding: 12px 12px;
      border-radius: 16px;
      border: 1px solid rgba(0,0,0,.12);
      background:#fff;
      cursor:pointer;
      text-align:left;
      font-weight:900;
    }
    .langBtn small{ display:block; font-weight:700; color:#6b7280; margin-top: 3px; }
    .langBtn:hover{ box-shadow: 0 10px 22px rgba(0,0,0,.08); }
    .langFoot{
      margin-top: 12px;
      color:#6b7280;
      font-size: 12px;
      line-height:1.4;
    }

    /* Top nav */
    .nav{
      position:sticky; top:0; z-index:30;
      background: rgba(242,236,228,.90);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid rgba(0,0,0,.06);
    }
    .navInner{
      display:flex; align-items:center; justify-content:space-between;
      padding: 14px 0;
      gap: 14px;
    }
    .brand{
      display:flex; gap:10px; align-items:baseline;
      font-weight:900; letter-spacing:-.01em;
    }
    .brand .main{ font-size: 15px; color:#111827; }
    .brand .sub{ font-size: 12px; color:#6b7280; font-weight:700; }

    .navLinks{ display:flex; gap: 10px; flex-wrap:wrap; align-items:center; }
    .navLinks a{
      font-size:14px;
      color:#111827;
      opacity:.85;
      padding: 8px 10px;
      border-radius: 10px;
      white-space:nowrap;
    }
    .navLinks a:hover{ background: rgba(0,0,0,.05); }

    .langSelect{
      display:flex; gap:10px; align-items:center; flex:0 0 auto;
    }
    .langSelect select{
      padding: 9px 10px;
      border-radius: 12px;
      border: 1px solid rgba(0,0,0,.14);
      background:#fff;
      font-weight:800;
      font-size: 13px;
      outline:none;
    }

    .btn{
      display:inline-flex; align-items:center; justify-content:center;
      padding: 11px 16px;
      border-radius: 14px;
      border: 1px solid rgba(0,0,0,.10);
      background: var(--btn);
      color: #1b1208;
      font-weight:900;
      cursor:pointer;
      box-shadow: 0 10px 18px rgba(176,140,98,.25);
      transition: transform .05s ease, background .15s ease, box-shadow .15s ease;
      white-space:nowrap;
    }
    .btn:hover{ background: var(--btnHover); box-shadow: 0 12px 22px rgba(176,140,98,.30); }
    .btn:active{ transform: translateY(1px); }
    .btn.secondary{
      background: transparent;
      color:#111827;
      border: 1px solid rgba(0,0,0,.12);
      box-shadow:none;
      font-weight:800;
    }
    .btn.secondary:hover{ background: rgba(0,0,0,.04); }

    /* Hero */
    .hero{
      background: linear-gradient(180deg, var(--bg) 0%, var(--panel) 100%);
      color: var(--white);
      padding: 72px 0 60px;
    }
    .heroGrid{
      display:grid;
      grid-template-columns: 1.15fr .85fr;
      gap: 24px;
      align-items:stretch;
    }
    .pill{
      display:inline-flex; align-items:center; gap:8px;
      font-size: 13px;
      color: rgba(255,255,255,.88);
      background: rgba(255,255,255,.08);
      border: 1px solid rgba(255,255,255,.12);
      padding: 8px 10px;
      border-radius: 999px;
      margin-bottom: 12px;
    }
    .hero h1{
      font-size: clamp(34px, 4.8vw, 58px);
      line-height:1.03;
      margin:0 0 14px;
      letter-spacing:-.03em;
    }
    .hero p{
      margin:0 0 18px;
      color: rgba(255,255,255,.86);
      font-size: 16px;
      max-width: 64ch;
    }
    .heroCtas{ display:flex; gap:12px; flex-wrap:wrap; margin-top: 18px; }

    .heroCard{
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.10);
      border-radius: var(--radius);
      padding: 18px;
      box-shadow: 0 14px 30px rgba(0,0,0,.22);
    }
    .heroCard h3{ margin:0 0 10px; font-size:16px; letter-spacing:.01em; }
    .steps{ margin:0; padding:0; list-style:none; }
    .steps li{
      display:flex; gap:10px;
      padding: 10px 10px;
      border-radius: 14px;
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.10);
      margin: 10px 0;
    }
    .steps .n{
      width:26px; height:26px; border-radius: 9px;
      display:flex; align-items:center; justify-content:center;
      background: rgba(176,140,98,.25);
      border: 1px solid rgba(176,140,98,.35);
      color: #f6efe6;
      font-weight:900;
      flex:0 0 auto;
    }
    .steps .t{ font-weight:900; color:#fff; font-size:14px; }
    .steps .d{ color: rgba(255,255,255,.82); font-size:13px; margin-top: 2px; line-height:1.35; }

    /* Sections */
    section{ padding: 56px 0; }
    .sectionTitle{ font-size: 28px; margin:0 0 14px; letter-spacing:-.01em; }
    .sectionLead{ margin:0 0 22px; color:#374151; max-width: 92ch; }

    .card{
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadowSoft);
    }
    .cardPad{ padding: 18px; }

    /* Explainer cards */
    .grid3{ display:grid; grid-template-columns: repeat(3, 1fr); gap: 14px; }
    .mini{ padding: 18px; }
    .mini h3{ margin: 0 0 8px; }
    .mini p{ margin: 0; color:#374151; }
    .mini .ex{
      margin-top: 10px;
      padding: 10px 12px;
      border-radius: 14px;
      background: rgba(0,0,0,.03);
      border: 1px solid rgba(0,0,0,.06);
      font-family: var(--mono);
      font-size: 13px;
      color:#111827;
      line-height: 1.4;
    }

    /* Simulator */
    .simWrap{
      display:grid;
      grid-template-columns: .95fr 1.05fr;
      gap: 18px;
      align-items: start;
    }
    .formRow{ display:grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    label{ font-size: 13px; color:#374151; display:block; margin: 0 0 7px; font-weight:800; }
    input, select{
      width:100%;
      padding: 11px 12px;
      border-radius: 14px;
      border: 1px solid rgba(0,0,0,.14);
      outline:none;
      background:#fff;
      font-size: 15px;
    }
    input:focus, select:focus{
      box-shadow: 0 0 0 4px var(--ring);
      border-color: rgba(176,140,98,.9);
    }

    .actions{ display:flex; gap:10px; margin-top: 12px; flex-wrap:wrap; }

    .results{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      margin-top: 14px;
    }
    .resultBox{
      border: 1px solid rgba(0,0,0,.10);
      border-radius: 16px;
      padding: 12px;
      background: #fff;
    }
    .resultBox .label{ font-size: 12px; color:#6b7280; }
    .resultBox .value{ font-family: var(--mono); font-size: 18px; margin-top: 6px; font-weight:900; }
    .resultBox .sub{ font-size: 12px; color:#6b7280; margin-top: 4px; }

    .formNote{
      font-size: 12px;
      color: #6b7280;
      margin-top: 12px;
      line-height: 1.45;
    }

    .howRead{
      margin-top: 14px;
      padding: 14px;
      border-radius: 16px;
      background: rgba(0,0,0,.03);
      border: 1px solid rgba(0,0,0,.06);
      color:#374151;
      line-height: 1.55;
      font-size: 13px;
    }
    .howRead h4{ margin:0 0 8px; font-size: 14px; color:#111827; }
    .howRead ul{ margin: 8px 0 0; padding-left: 18px; }
    .howRead li{ margin: 8px 0; }

    .chartCard{ padding: 14px 14px 10px; }
    canvas{ width:100% !important; height: 500px !important; }

    /* Premium lock */
    .lock{
      display:none;
      margin-top: 10px;
      padding: 12px;
      border-radius: 16px;
      background: rgba(176,140,98,.18);
      border: 1px solid rgba(176,140,98,.35);
      color:#3c2a17;
      line-height: 1.45;
      font-size: 13px;
    }

    /* Pricing */
    .pricingGrid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 14px;
      align-items: stretch;
      margin-top: 12px;
    }
    .priceCard{ padding: 18px; position:relative; }
    .priceCard h3{ margin:0 0 6px; }
    .priceCard .tag{ color:#6b7280; font-size: 13px; }
    .priceCard .big{ font-family: var(--mono); font-weight:900; font-size: 30px; margin: 12px 0 12px; }
    .priceCard ul{ margin:0; padding-left: 18px; color:#374151; }
    .priceCard li{ margin: 8px 0; }
    .badge{
      position:absolute; top: 14px; right: 14px;
      font-size: 11px;
      padding: 6px 8px;
      border-radius: 999px;
      background: rgba(176,140,98,.18);
      border: 1px solid rgba(176,140,98,.40);
      color:#6b4b26;
      font-weight:900;
    }

    /* Footer */
    footer{ padding: 30px 0 46px; color:#6b7280; font-size: 13px; }
    .legal{
      background: rgba(0,0,0,.03);
      border: 1px solid rgba(0,0,0,.06);
      border-radius: 14px;
      padding: 12px;
      line-height: 1.45;
      margin-top: 10px;
    }

    @media (max-width: 980px){
      .heroGrid{ grid-template-columns: 1fr; }
      .simWrap{ grid-template-columns: 1fr; }
      .grid3{ grid-template-columns: 1fr; }
      .pricingGrid{ grid-template-columns: 1fr; }
      canvas{ height: 420px !important; }
      .navLinks{ display:none; }
      .langBtns{ grid-template-columns: 1fr; }
    }
  </style>
</head>

<body>
  <!-- Language overlay -->
  <div class="langOverlay" id="langOverlay" aria-modal="true" role="dialog">
    <div class="langCard">
      <h2 id="langTitle">Elige idioma</h2>
      <p id="langLead">Puedes cambiarlo más tarde arriba a la derecha.</p>
      <div class="langBtns">
        <button class="langBtn" onclick="setLang('es', true)">Español<small>ES</small></button>
        <button class="langBtn" onclick="setLang('en', true)">English<small>EN</small></button>
        <button class="langBtn" onclick="setLang('da', true)">Dansk<small>DA</small></button>
        <button class="langBtn" onclick="setLang('fr', true)">Français<small>FR</small></button>
      </div>
      <div class="langFoot" id="langFoot">
        Nota: esta web es educativa. No es asesoramiento financiero.
      </div>
    </div>
  </div>

  <!-- NAV -->
  <div class="nav">
    <div class="container">
      <div class="navInner">
        <div class="brand">
          <div class="main" data-i18n="brand_main">Construye tu futuro</div>
          <div class="sub" data-i18n="brand_sub">con menos de lo que te imaginas</div>
        </div>

        <div class="navLinks">
          <a href="#interes-compuesto" data-i18n="nav_compound">Interés compuesto</a>
          <a href="#simulador" data-i18n="nav_sim">Simulador</a>
          <a href="#guia" data-i18n="nav_guide">Guía</a>
          <a href="#precios" data-i18n="nav_pricing">Suscripción</a>
        </div>

        <div class="langSelect">
          <a id="planPill"
          href="#precios"
          data-i18n="nav_plans"
         style="display:inline-flex; padding:8px 10px; border-radius:999px; border:1px solid rgba(0,0,0,.12); background:#fff; font-size:12px; font-weight:900; color:#111827; white-space:nowrap;">
         Planes
         </a>

          <select id="langSelect" aria-label="Language">
            <option value="es">ES</option>
            <option value="en">EN</option>
            <option value="da">DA</option>
            <option value="fr">FR</option>
          </select>
          <a class="btn" href="#simulador" data-i18n="cta_sim">Simular ahora</a>
          <a class="btn secondary" href="/login.html">Acceder</a>
        </div>
      </div>
    </div>
  </div>

  <!-- HERO -->
  <header class="hero">
    <div class="container">
      <div class="heroGrid">
        <div>
          <div class="pill" data-i18n="hero_pill">⏳ Jóvenes 18-30 · Poco capital · Mucho tiempo</div>
          <h1 data-i18n="hero_h1">Si no tienes mucho dinero, tu ventaja es empezar pronto.</h1>
          <p data-i18n="hero_p">
            Mucha gente no invierte porque cree que “100€ al mes no cambia nada”.
            La realidad: con <b>tiempo</b>, esos 100€ pueden convertirse en muchísimo.
            Aquí lo verás con una simulación clara.
          </p>

          <div class="heroCtas">
            <a class="btn" href="#simulador" data-i18n="hero_btn">Probar simulador</a>
          </div>

          <p style="margin-top:14px; font-size:13px; color:rgba(255,255,255,.78);" data-i18n="hero_note">
            Educación financiera. No tocamos tu dinero. Tú inviertes desde tu broker.
          </p>
        </div>

        <div class="heroCard">
          <h3 data-i18n="what_title">Qué hacemos (sin tecnicismos)</h3>
          <ul class="steps">
            <li>
              <div class="n">1</div>
              <div>
                <div class="t" data-i18n="what_1_t">Te lo ponemos fácil</div>
                <div class="d" data-i18n="what_1_d">Estrategias simples (Global / EE.UU. / Europa) con ETFs de bajo coste.</div>
              </div>
            </li>
            <li>
              <div class="n">2</div>
              <div>
                <div class="t" data-i18n="what_2_t">Lo ves con números</div>
                <div class="d" data-i18n="what_2_d">“Euros futuros” y “euros de hoy” para entender la inflación.</div>
              </div>
            </li>
            <li>
              <div class="n">3</div>
              <div>
                <div class="t" data-i18n="what_3_t">Pagas por ejecución</div>
                <div class="d" data-i18n="what_3_d">Guía + checklist + recordatorio mensual para no abandonar.</div>
              </div>
            </li>
          </ul>
        </div>

      </div>
    </div>
  </header>

  <!-- EXPLAINER -->
  <section id="interes-compuesto">
    <div class="container">
      <h2 class="sectionTitle" data-i18n="comp_title">Interés compuesto en 30 segundos</h2>
      <p class="sectionLead" data-i18n="comp_lead">
        Es simple: <b>ganas dinero sobre tu dinero</b>, y con los años, también ganas sobre lo que ya ganaste antes.
        Por eso el crecimiento es lento al inicio… y se dispara al final.
      </p>

      <div class="grid3">
        <div class="card mini">
          <h3 data-i18n="comp_1_t">1) Tú pones la semilla</h3>
          <p data-i18n="comp_1_p">Al principio casi todo es aporte tuyo. Parece lento, pero estás construyendo la base.</p>
          <div class="ex" data-i18n="comp_1_ex">Si aportas 100€/mes:<br>en 1 año: 1.200€ aportados</div>
        </div>
        <div class="card mini">
          <h3 data-i18n="comp_2_t">2) El tiempo acelera</h3>
          <p data-i18n="comp_2_p">Con los años, el crecimiento del mercado empieza a pesar más que tus aportaciones.</p>
          <div class="ex" data-i18n="comp_2_ex">Año 5: manda tu ahorro<br>Año 25: manda el compuesto</div>
        </div>
        <div class="card mini">
          <h3 data-i18n="comp_3_t">3) Tu ventaja es empezar</h3>
          <p data-i18n="comp_3_p">Si no tienes gran capital, no compites con dinero. Compites con el reloj.</p>
          <div class="ex" data-i18n="comp_3_ex">Lo más difícil es empezar.<br>Lo más rentable: mantener.</div>
        </div>
      </div>

      <!-- ✅ Texto traducible separado (ya no pisa la snowball) -->
      <div class="legal" data-i18n="comp_legal">
        Usamos rentabilidades medias a largo plazo (modelo educativo). Habrá años buenos y malos.
      </div>

    </div>
  </section>

  <!-- SIMULATOR -->
  <section id="simulador">
    <div class="container">
      <h2 class="sectionTitle" data-i18n="sim_title">Simulador</h2>
      <p class="sectionLead" data-i18n="sim_lead">
        Ajusta edad y aportación mensual. Verás 4 líneas:
        inversión (euros futuros), inversión (euros de hoy), ahorro (euros futuros) y ahorro (euros de hoy).
        <b>Puedes ocultar líneas</b> haciendo click en el nombre dentro de la leyenda.
      </p>

      <div class="simWrap">
        <div class="card">
          <div class="cardPad">
            <div class="formRow">
              <div>
                <label for="age" data-i18n="age_label">Edad actual</label>
                <select id="age"></select>
              </div>
              <div>
                <label for="retAge" data-i18n="ret_label">Edad objetivo</label>
                <select id="retAge"></select>
              </div>
            </div>

            <div class="formRow" style="margin-top:12px;">
              <div>
                <label for="monthly" data-i18n="monthly_label">Aportación mensual (EUR)</label>
                <input type="number" id="monthly" min="10" max="50000" value="100" />
              </div>
              <div>
                <label for="initial" data-i18n="initial_label">Aportación inicial (EUR) (opcional)</label>
                <input type="number" id="initial" min="0" max="100000000" value="0" />
              </div>
            </div>

            <div style="margin-top:12px;">
              <label for="portfolio" data-i18n="strategy_label">Estrategia</label>
              <select id="portfolio">
                <option value="global" data-i18n="opt_global">Conservador - Global</option>
                <option value="usa" data-i18n="opt_usa">Moderado - EE.UU.</option>
                <option value="eu" data-i18n="opt_eu">Moderado - Europa</option>
                <option value="risk" data-i18n="opt_risk">Arriesgado - Cartera personalizada (Premium)</option>
              </select>
            </div>

            <div class="lock" id="premiumLock">
              <b data-i18n="lock_b">Arriesgado (Premium):</b>
              <span data-i18n="lock_t">esta opción está pensada para la suscripción premium con cartera personalizada. En demo usamos un supuesto “alto” solo para visualizar (no es una promesa).</span>
              <div style="margin-top:10px;">
                <a class="btn" href="#precios" data-i18n="lock_btn">Ver Premium</a>
              </div>
            </div>

            <div class="formNote" id="ratesNote"></div>

            <div class="actions">
              <button class="btn" id="btnSim" data-i18n="btn_sim">Simular</button>
              <button class="btn secondary" id="btnReset" data-i18n="btn_reset">Reset</button>
            </div>

            <div class="results">
              <div class="resultBox">
                <div class="label" data-i18n="res_nom_label">Resultado final (euros futuros)</div>
                <div class="value" id="resNominal">-</div>
                <div class="sub" id="resHorizon">-</div>
              </div>
              <div class="resultBox">
                <div class="label" data-i18n="res_real_label">Resultado final (euros de hoy)</div>
                <div class="value" id="resReal">-</div>
                <div class="sub" data-i18n="infl_note">Inflación asumida: 3% anual</div>
              </div>
            </div>

            <div class="results">
              <div class="resultBox">
                <div class="label" data-i18n="sav_nom_label">Ahorro total (lo que tú pones)</div>
                <div class="value" id="resSaveNom">-</div>
                <div class="sub" data-i18n="sav_nom_sub">Sin inversión (solo aportaciones)</div>
              </div>
              <div class="resultBox">
                <div class="label" data-i18n="sav_real_label">Ahorro total (euros de hoy)</div>
                <div class="value" id="resSaveReal">-</div>
                <div class="sub" data-i18n="sav_real_sub">Poder adquisitivo estimado a precios de hoy</div>
              </div>
            </div>

            <div class="howRead">
              <h4 data-i18n="read_title">Cómo leer la gráfica (bien explicado)</h4>
              <ul>
                <li data-i18n="read_1"><b>Euros futuros</b>: es el número “del año X”. Suena enorme, pero el dinero habrá perdido valor.</li>
                <li data-i18n="read_2"><b>Euros de hoy</b>: es la estimación de <b>poder adquisitivo</b> (lo que equivaldría a precios actuales).</li>
                <li data-i18n="read_3"><b>Ahorro</b>: es lo que tú pones. Sirve para ver cuánto viene del mercado.</li>
                <li data-i18n="read_4">Truco: mira la diferencia entre <b>Inversión</b> y <b>Ahorro</b>. Esa diferencia es el “compuesto”.</li>
              </ul>
            </div>

            <div class="formNote" data-i18n="sim_disclaimer">
              * Simulación educativa (modelo simplificado). Invertir conlleva riesgo. Rentabilidades pasadas no garantizan resultados futuros.
            </div>
          </div>
        </div>

        <div class="card chartCard">
          <div style="display:flex; justify-content:space-between; align-items:center; padding: 10px 10px 0;">
            <div style="font-weight:900;" data-i18n="chart_title">Evolución (puedes ocultar líneas en la leyenda)</div>
            <div style="font-size:12px; color:#6b7280;" data-i18n="chart_hint">Haz click en el nombre: se oculta / aparece</div>
          </div>
          <div style="padding: 6px 6px 6px;">
            <canvas id="chart"></canvas>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- GUIDE (Starter/Premium) -->
  <section id="guia">
    <div class="container">
      <h2 class="sectionTitle" data-i18n="guide_title">Guía interactiva (Starter)</h2>
      <p class="sectionLead" data-i18n="guide_lead">
        Te decimos exactamente cómo empezar desde 0: elegir broker, abrir la cuenta y hacer tu primera compra.
      </p>
      <a class="btn" href="/login.html">Entrar a mi guía</a>
      <div class="card" style="overflow:hidden;">
        <div id="guideLock" style="padding:18px; background: rgba(0,0,0,.03); border-bottom:1px solid rgba(0,0,0,.06); display:none;">
          <div style="font-weight:900; margin-bottom:6px;" data-i18n="guide_locked_title">Desbloquea Starter</div>
          <div style="color:#374151; line-height:1.5;" data-i18n="guide_locked_body">
            La demo te enseña el concepto. Starter te da ejecución: broker recomendado + guía paso a paso + plan mensual.
          </div>
          <div style="margin-top:12px; display:flex; gap:10px; flex-wrap:wrap;">
            <a class="btn" href="#precios" data-i18n="guide_locked_btn">Ver Starter</a>
          </div>
        </div>

        <div id="guideContent" style="padding:18px;">
          <div style="display:grid; grid-template-columns: 1fr 1fr; gap:14px;">
            <div class="card" style="box-shadow:none; border:1px solid rgba(0,0,0,.08);">
              <div class="cardPad">
                <div style="font-weight:900; margin-bottom:6px;" data-i18n="guide_broker_title">1) Broker recomendado</div>
                <div style="color:#374151; line-height:1.5;" data-i18n="guide_broker_body">
                  Te recomendamos 1–2 brokers según tu país (costes, ETF disponibles y facilidad).
                </div>
              </div>
            </div>

            <div class="card" style="box-shadow:none; border:1px solid rgba(0,0,0,.08);">
              <div class="cardPad">
                <div style="font-weight:900; margin-bottom:6px;" data-i18n="guide_setup_title">2) Configuración desde 0</div>
                <div style="color:#374151; line-height:1.5;" data-i18n="guide_setup_body">
                  Pasos interactivos: crear cuenta, KYC, cuenta de valores, y primeras transferencias.
                </div>
              </div>
            </div>

            <div class="card" style="box-shadow:none; border:1px solid rgba(0,0,0,.08);">
              <div class="cardPad">
                <div style="font-weight:900; margin-bottom:6px;" data-i18n="guide_buy_title">3) Tu primera compra</div>
                <div style="color:#374151; line-height:1.5;" data-i18n="guide_buy_body">
                  Qué ETF comprar (según estrategia), cómo poner la orden, y qué revisar antes de confirmar.
                </div>
              </div>
            </div>

            <div class="card" style="box-shadow:none; border:1px solid rgba(0,0,0,.08);">
              <div class="cardPad">
                <div style="font-weight:900; margin-bottom:6px;" data-i18n="guide_month_title">4) Plan mensual (60 segundos)</div>
                <div style="color:#374151; line-height:1.5;" data-i18n="guide_month_body">
                  Cada mes te llega un mensaje corto: entra, compra, y no hagas nada más.
                </div>
              </div>
            </div>
          </div>

          <div class="legal" style="margin-top:14px;" data-i18n="guide_note">
            Nota: no custodiamos tu dinero y no ejecutamos órdenes. Tú inviertes desde tu broker.
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- PRICING -->
  <section id="precios">
    <div class="container">
      <h2 class="sectionTitle" data-i18n="price_title">Suscripción</h2>
      <p class="sectionLead" data-i18n="price_lead">
        La demo te enseña el concepto. La suscripción te da <b>ejecución</b>: guía, checklist y recordatorios para mantener el hábito.
      </p>

      <div class="pricingGrid">
        <div class="card priceCard">
          <h3 data-i18n="starter_title">Starter</h3>
          <div class="tag" data-i18n="starter_tag">Para empezar ya (sin perderte)</div>
          <div class="big"><span id="price5">5€ / mes</span></div>
          <ul>
            <li data-i18n="starter_1">Guía paso a paso: de 0 a tu primera compra (sin tecnicismos)</li>
            <li data-i18n="starter_2">Checklist mensual de 1 minuto (para no fallar)</li>
            <li data-i18n="starter_3">Recordatorio mensual (email) + plantillas</li>
            <li data-i18n="starter_4">Mini-lección mensual (5 min): 1 concepto clave</li>
          </ul>
          <div style="margin-top:14px;">
            <button class="btn" id="btnStarter" onclick="buyPlan('starter');" data-i18n="pay_btn">Suscribirme</button>
          </div>
        </div>

        <div class="card priceCard">
          <div class="badge" data-i18n="premium_badge">Premium</div>
          <h3 data-i18n="premium_title">Personalizada</h3>
          <div class="tag" data-i18n="premium_tag">Para quien quiere “Arriesgado” + estructura</div>
          <div class="big"><span id="price9">9€ / mes</span></div>
          <ul>
            <li data-i18n="premium_1">Todo lo de Starter</li>
            <li data-i18n="premium_2">Acceso a “Arriesgado” (cartera personalizada)</li>
            <li data-i18n="premium_3">Checklist mensual ampliado (2 min) + control de riesgo</li>
            <li data-i18n="premium_4">Modo avanzado del simulador (extra aportaciones/objetivo)</li>
          </ul>
          <div style="margin-top:14px;">
            <button class="btn" id="btnPremium" onclick="buyPlan('premium');" data-i18n="premium_btn">Quiero Premium</button>
          </div>
        </div>
      </div>

      <div class="legal" data-i18n="price_legal">
        Transparencia: nosotros no custodiamos tu dinero. Tú inviertes desde tu propio broker. Esto es educación financiera.
      </div>
    </div>
  </section>
<div style="margin-top:14px; display:flex; gap:12px; flex-wrap:wrap; font-size:13px;">
  <a href="/terms.html" target="_blank">Términos</a>
  <a href="/disclaimer.html" target="_blank">Aviso legal</a>
  <a href="mailto:construyetufuturo.web@gmail.com">
  construyetufuturo.web@gmail.com
</a>
</div>

<!-- SNOWBALL (signature) -->
<section id="snowball-signature" style="padding:56px 0;">
  <div class="container">
    <div class="card snowWrap snowSignature">
      <div class="snowGrid">
        <div class="snowLeft">
          <h2 class="sectionTitle" style="margin-bottom:10px;" data-i18n="snow_title">
            La bola de nieve (mi forma favorita de explicarlo)
          </h2>
          <p class="sectionLead" style="margin-bottom:14px;" data-i18n="snow_lead">
            Cuando eres joven, una “pelotita” pequeña puede hacerse enorme si la dejas rodar con tiempo. Eso es el interés compuesto.
          </p>

          <div class="snowControls">
            <div>
              <label for="snowYears" data-i18n="snow_years_label">Años</label>
              <div class="rangeRow">
                <input id="snowYears" type="range" min="1" max="45" value="10" />
                <div class="rangePill" id="snowYearsPill">10</div>
              </div>
            </div>

            <div class="formRow">
              <div>
                <label for="snowMonthly" data-i18n="snow_monthly_label">Aporte mensual</label>
                <input id="snowMonthly" type="number" min="0" max="50000" value="100" />
              </div>
              <div>
                <label for="snowRate" data-i18n="snow_rate_label">Rentabilidad anual (educativa)</label>
                <input id="snowRate" type="number" min="0" max="30" value="8" />
              </div>
            </div>

            <div class="snowStats">
              <div class="snowStat">
                <div class="k" data-i18n="snow_future">Euros futuros</div>
                <div class="v" id="snowNom">-</div>
              </div>
              <div class="snowStat">
                <div class="k" data-i18n="snow_today">Euros de hoy (inflación)</div>
                <div class="v" id="snowReal">-</div>
              </div>
            </div>

            <div class="legal" style="margin-top:10px;" data-i18n="snow_note">
              “Euros de hoy” = poder adquisitivo estimado con inflación fija del 3% anual (solo para entender el concepto).
            </div>
          </div>
        </div>

         <div class="snowStage snowStageRoll" id="snowStage" aria-label="Snowball signature">
   <div class="snowSlope"></div>
   <div class="snowBall" id="snowBall"></div>
   <div class="snowGround"></div>
   </div>
      </div>
    </div>
  </div>
</section>
  <footer>
    <div class="container">
      <div style="font-weight:900; color:#111827;" data-i18n="brand_main">Construye tu futuro</div>
      <div class="legal" data-i18n="footer_legal">
        Aviso: contenido educativo. No es asesoramiento financiero. Rentabilidades pasadas no garantizan rentabilidades futuras.
      </div>
      <div style="margin-top:10px;"><div style="margin-top:10px;">
  Contacto:
  <a href="mailto:construyetufuturo.web@gmail.com">
    construyetufuturo.web@gmail.com
  </a>
</div>&copy; <span id="year"></span></div>
    </div>
  </footer>

  <script>
    // Fixed inflation (hidden)
    const INFLATION = 0.03; // 3% annual

    // Rates (educational assumptions)
    // Global: 9% nominal, 6% real
    // USA: 10% nominal, 7% real
    // Europe: 8% nominal, 5% real (placeholder)
    // Risk premium: 12% nominal, 8% real (placeholder)
const PORTFOLIOS = {
  global: { nameKey:"opt_global", nominal:0.09, premium:false },
  usa:    { nameKey:"opt_usa",    nominal:0.10, premium:false },
  eu:     { nameKey:"opt_eu",     nominal:0.08, premium:false },
  risk:   { nameKey:"opt_risk",   nominal:0.12, premium:true }
};

    // Chart colors (more distinct)
    const SERIES_COLORS = {
      invNom: "#1f77b4",
      invReal:"#ff7f0e",
      savNom: "#2ca02c",
      savReal:"#d62728"
    };

    // i18n dictionary
    const i18n = {
      es: {
        nav_guide: "Guía",
        plan_free: "Gratis",
        plan_starter: "Starter",
        plan_premium: "Premium",
        plan_active: "Plan: ",
        guide_title: "Guía interactiva (Starter)",
        guide_lead: "Te decimos exactamente cómo empezar desde 0: elegir broker, abrir la cuenta y hacer tu primera compra.",
        guide_locked_title: "Desbloquea Starter",
        guide_locked_body: "La demo te enseña el concepto. Starter te da ejecución: broker recomendado + guía paso a paso + plan mensual.",
        guide_locked_btn: "Ver Starter",
        guide_broker_title: "1) Broker recomendado",
        guide_broker_body: "Te recomendamos 1–2 brokers según tu país (costes, ETF disponibles y facilidad).",
        guide_setup_title: "2) Configuración desde 0",
        guide_setup_body: "Pasos interactivos: crear cuenta, KYC, cuenta de valores, y primeras transferencias.",
        guide_buy_title: "3) Tu primera compra",
        guide_buy_body: "Qué ETF comprar (según estrategia), cómo poner la orden, y qué revisar antes de confirmar.",
        guide_month_title: "4) Plan mensual (60 segundos)",
        guide_month_body: "Cada mes te llega un mensaje corto: entra, compra, y no hagas nada más.",
        guide_note: "Nota: no custodiamos tu dinero y no ejecutamos órdenes. Tú inviertes desde tu broker.",
        risk_preview_note: "Vista previa: para desbloquear Arriesgado necesitas Premium.",
        
        nav_plans: "Planes",
        brand_main: "Construye tu futuro",
        brand_sub: "con menos de lo que te imaginas",
        nav_compound: "Interés compuesto",
        nav_sim: "Simulador",
        nav_pricing: "Suscripción",
        cta_sim: "Simular ahora",
        hero_pill: "⏳ Jóvenes 18-30 · Poco capital · Mucho tiempo",
        hero_h1: "Si no tienes mucho dinero, tu ventaja es empezar pronto.",
        hero_p: "Mucha gente no invierte porque cree que “100€ al mes no cambia nada”. La realidad: con <b>tiempo</b>, esos 100€ pueden convertirse en muchísimo. Aquí lo verás con una simulación clara.",
        hero_btn: "Probar simulador",
        hero_note: "Educación financiera. No tocamos tu dinero. Tú inviertes desde tu broker.",
        what_title: "Qué hacemos (sin tecnicismos)",
        what_1_t: "Te lo ponemos fácil",
        what_1_d: "Estrategias simples (Global / EE.UU. / Europa) con ETFs de bajo coste.",
        what_2_t: "Lo ves con números",
        what_2_d: "“Euros futuros” y “euros de hoy” para entender la inflación.",
        what_3_t: "Pagas por ejecución",
        what_3_d: "Guía + checklist + recordatorio mensual para no abandonar.",
        comp_title: "Interés compuesto en 30 segundos",
        comp_lead: "Es simple: <b>ganas dinero sobre tu dinero</b>, y con los años, también ganas sobre lo que ya ganaste antes. Por eso el crecimiento es lento al inicio… y se dispara al final.",
        comp_1_t: "1) Tú pones la semilla",
        comp_1_p: "Al principio casi todo es aporte tuyo. Parece lento, pero estás construyendo la base.",
        comp_1_ex: "Si aportas 100€/mes:<br>en 1 año: 1.200€ aportados",
        comp_2_t: "2) El tiempo acelera",
        comp_2_p: "Con los años, el crecimiento del mercado empieza a pesar más que tus aportaciones.",
        comp_2_ex: "Año 5: manda tu ahorro<br>Año 25: manda el compuesto",
        comp_3_t: "3) Tu ventaja es empezar",
        comp_3_p: "Si no tienes gran capital, no compites con dinero. Compites con el reloj.",
        comp_3_ex: "Lo más difícil es empezar.<br>Lo más rentable: mantener.",
        comp_legal: "Usamos rentabilidades medias a largo plazo (modelo educativo). Habrá años buenos y malos.",

        // ✅ SNOWBALL keys
        snow_title: "Demo “bola de nieve” (renta compuesta)",
        snow_lead: "Mueve los años: al principio crece lento, y luego acelera. Eso es el compuesto. También verás “euros futuros” vs “euros de hoy” (inflación).",
        snow_years_label: "Años",
        snow_monthly_label: "Aporte mensual",
        snow_rate_label: "Rentabilidad anual (educativa)",
        snow_future: "Euros futuros",
        snow_today: "Euros de hoy (inflación)",
        snow_note: "“Euros de hoy” = poder adquisitivo estimado con inflación fija del 3% anual (solo para entender el concepto).",

        sim_title: "Simulador",
        sim_lead: "Ajusta edad y aportación mensual. Verás 4 líneas: inversión (euros futuros), inversión (euros de hoy), ahorro (euros futuros) y ahorro (euros de hoy). <b>Puedes ocultar líneas</b> haciendo click en el nombre dentro de la leyenda.",
        age_label: "Edad actual",
        ret_label: "Edad objetivo",
        monthly_label: "Aportación mensual ({CUR})",
        initial_label: "Aportación inicial ({CUR}) (opcional)",
        strategy_label: "Estrategia",
        opt_global: "Conservador - Global",
        opt_usa: "Moderado - EE.UU.",
        opt_eu: "Moderado - Europa",
        opt_risk: "Arriesgado - Cartera personalizada (Premium)",
        lock_b: "Arriesgado (Premium):",
        lock_t: "esta opción está pensada para la suscripción premium con cartera personalizada. En demo usamos un supuesto “alto” solo para visualizar (no es una promesa).",
        lock_btn: "Ver Premium",
        btn_sim: "Simular",
        btn_reset: "Reset",
        res_nom_label: "Resultado final (euros futuros)",
        res_real_label: "Resultado final (euros de hoy)",
        infl_note: "Inflación asumida: 3% anual",
        sav_nom_label: "Ahorro total (lo que tú pones)",
        sav_nom_sub: "Sin inversión (solo aportaciones)",
        sav_real_label: "Ahorro total (euros de hoy)",
        sav_real_sub: "Poder adquisitivo estimado a precios de hoy",
        read_title: "Cómo leer la gráfica (bien explicado)",
        read_1: "<b>Euros futuros</b>: es el número “del año X”. Suena enorme, pero el dinero habrá perdido valor.",
        read_2: "<b>Euros de hoy</b>: es la estimación de <b>poder adquisitivo</b> (lo que equivaldría a precios actuales).",
        read_3: "<b>Ahorro</b>: es lo que tú pones. Sirve para ver cuánto viene del mercado.",
        read_4: "Truco: mira la diferencia entre <b>Inversión</b> y <b>Ahorro</b>. Esa diferencia es el “compuesto”.",
        sim_disclaimer: "* Simulación educativa (modelo simplificado). Invertir conlleva riesgo. Rentabilidades pasadas no garantizan resultados futuros.",
        chart_title: "Evolución (puedes ocultar líneas en la leyenda)",
        chart_hint: "Haz click en el nombre: se oculta / aparece",
        k1: "Inversión (euros futuros)",
        k2: "Inversión (euros de hoy)",
        k3: "Ahorro (euros futuros)",
        k4: "Ahorro (euros de hoy)",
        price_title: "Suscripción",
        price_lead: "La demo te enseña el concepto. La suscripción te da <b>ejecución</b>: te decimos exactamente qué hacer y cuándo (sin complicarte) para mantener el hábito.",
        starter_title: "Starter",
        starter_tag: "Para empezar ya (sin perderte)",
        starter_1: "Recomendación de broker + guía interactiva para crear tu cuenta de valores desde 0",
        starter_2: "Plan mensual de 60 segundos: qué hacer este mes para mantener el hábito",
        starter_3: "Recordatorio mensual (email) + plantillas (tu plan en 1 hoja)",
        starter_4: "Soporte “anti-errores”: comisiones, divisa, y fallos típicos al comprar tu primer ETF",
        pay_btn: "Suscribirme",
        premium_badge: "Premium",
        premium_title: "Personalizada",
        premium_tag: "Para quien quiere “Arriesgado” + estructura",
        premium_1: "Todo lo de Starter",
        premium_2: "Acceso a “Arriesgado” (cartera personalizada)",
        premium_3: "Checklist mensual ampliado (2 min) + control de riesgo",
        premium_4: "Modo avanzado del simulador (objetivo + aportaciones extra)",
        premium_btn: "Quiero Premium",
        price_legal: "Transparencia: nosotros no custodiamos tu dinero. Tú inviertes desde tu propio broker. Esto es educación financiera.",
        footer_legal: "Aviso: contenido educativo. No es asesoramiento financiero. Rentabilidades pasadas no garantizan rentabilidades futuras.",
        pay_stub: "Aquí conectarás el pago (Stripe) cuando lo tengas.",
        pay_stub_premium: "Aquí conectarás el pago Premium (Stripe) cuando lo tengas.",
        langTitle: "Elige idioma",
        langLead: "Puedes cambiarlo más tarde arriba a la derecha.",
        langFoot: "Nota: esta web es educativa. No es asesoramiento financiero."
      },

      en: {
        nav_guide: "Guide",
        plan_free: "Free",
        plan_starter: "Starter",
        plan_premium: "Premium",
        plan_active: "Plan: ",
        guide_title: "Interactive guide (Starter)",
        guide_lead: "We tell you exactly how to start from zero: pick a broker, open the account, and place your first buy.",
        guide_locked_title: "Unlock Starter",
        guide_locked_body: "The demo teaches the concept. Starter gives execution: broker recommendation + step-by-step guide + monthly plan.",
        guide_locked_btn: "See Starter",
        guide_broker_title: "1) Broker recommendation",
        guide_broker_body: "We recommend 1–2 brokers based on your country (fees, available ETFs, simplicity).",
        guide_setup_title: "2) Setup from zero",
        guide_setup_body: "Interactive steps: account creation, KYC, brokerage account, and first transfers.",
        guide_buy_title: "3) Your first buy",
        guide_buy_body: "Which ETF to buy (by strategy), how to place the order, and what to check before confirming.",
        guide_month_title: "4) Monthly plan (60 seconds)",
        guide_month_body: "Each month you get a short message: log in, buy, and do nothing else.",
        guide_note: "Note: we don't custody your money and we don't execute orders. You invest from your own broker.",
        risk_preview_note: "Preview: unlock Aggressive with Premium.",

        nav_plans: "Plans",
        brand_main: "Build your future",
        brand_sub: "with less than you think",
        nav_compound: "Compound interest",
        nav_sim: "Simulator",
        nav_pricing: "Pricing",
        cta_sim: "Simulate now",
        hero_pill: "⏳ Ages 18–30 · Low capital · Long time",
        hero_h1: "If you don't have much money, your advantage is starting early.",
        hero_p: "Many people don't invest because they think “€100/month won't change anything”. Reality: with <b>time</b>, that €100 can become a lot. You'll see it clearly in the simulation.",
        hero_btn: "Try the simulator",
        hero_note: "Financial education. We don't touch your money. You invest from your own broker.",
        what_title: "What we do (no jargon)",
        what_1_t: "We keep it simple",
        what_1_d: "Simple strategies (Global / US / Europe) using low-cost ETFs.",
        what_2_t: "You see it with numbers",
        what_2_d: "“Future euros” vs “today's euros” to understand inflation.",
        what_3_t: "You pay for execution",
        what_3_d: "Guide + checklist + monthly reminder so you don't quit.",
        comp_title: "Compound interest in 30 seconds",
        comp_lead: "Simple idea: you earn money on your money — and over time, you also earn on what you earned before. That's why growth looks slow at first… and accelerates later.",
        comp_1_t: "1) You plant the seed",
        comp_1_p: "At first, most of it is your own contributions. It looks slow, but you're building the base.",
        comp_1_ex: "If you invest €100/month:<br>after 1 year: €1,200 contributed",
        comp_2_t: "2) Time speeds it up",
        comp_2_p: "Over the years, market growth starts to outweigh your contributions.",
        comp_2_ex: "Year 5: your saving dominates<br>Year 25: compounding dominates",
        comp_3_t: "3) Your edge is starting",
        comp_3_p: "If you don't have big capital, you don't compete with money. You compete with the clock.",
        comp_3_ex: "Hardest part: starting.<br>Most profitable: staying consistent.",
        comp_legal: "We use long-term average returns (educational model). There will be good years and bad years.",

        // ✅ SNOWBALL keys
        snow_title: "“Snowball” demo (compound interest)",
        snow_lead: "Move the years: it grows slowly at first, then accelerates. That’s compounding. You’ll also see “future euros” vs “today’s euros” (inflation).",
        snow_years_label: "Years",
        snow_monthly_label: "Monthly contribution",
        snow_rate_label: "Annual return (educational)",
        snow_future: "Future euros",
        snow_today: "Today’s euros (inflation)",
        snow_note: "“Today’s euros” = estimated purchasing power assuming a fixed 3% annual inflation (just to understand the idea).",

        sim_title: "Simulator",
        sim_lead: "Choose your age and monthly amount. You'll see 4 lines: investment (future euros), investment (today's euros), savings (future euros) and savings (today's euros). <b>You can hide lines</b> by clicking their names in the legend.",
        age_label: "Current age",
        ret_label: "Target age",
        monthly_label: "Monthly contribution ({CUR})",
        initial_label: "Initial contribution ({CUR}) (optional)",
        strategy_label: "Strategy",
        opt_global: "Conservative — Global",
        opt_usa: "Moderate — US",
        opt_eu: "Moderate — Europe",
        opt_risk: "Aggressive — Personalized portfolio (Premium)",
        lock_b: "Aggressive (Premium):",
        lock_t: "this option is meant for a Premium subscription with a personalized portfolio. In the demo we use a “high” assumption only to visualize (not a promise).",
        lock_btn: "See Premium",
        btn_sim: "Simulate",
        btn_reset: "Reset",
        res_nom_label: "Final result (future euros)",
        res_real_label: "Final result (today's euros)",
        infl_note: "Assumed inflation: 3% per year",
        sav_nom_label: "Total savings (what you put in)",
        sav_nom_sub: "No investing (just contributions)",
        sav_real_label: "Total savings (today's euros)",
        sav_real_sub: "Estimated purchasing power in today's money",
        read_title: "How to read the chart (clearly)",
        read_1: "<b>Future euros</b>: the big number in year X. Sounds huge, but money will be worth less.",
        read_2: "<b>Today's euros</b>: estimated <b>purchasing power</b> (what it would be worth in today's prices).",
        read_3: "<b>Savings</b>: what you contribute. Helps you see how much comes from the market.",
        read_4: "Tip: look at the gap between <b>Investment</b> and <b>Savings</b>. That's compounding.",
        sim_disclaimer: "* Educational simulation (simplified model). Investing involves risk. Past returns do not guarantee future results.",
        chart_title: "Growth (hide lines in the legend)",
        chart_hint: "Click a name: hide / show",
        k1: "Investment (future euros)",
        k2: "Investment (today's euros)",
        k3: "Savings (future euros)",
        k4: "Savings (today's euros)",
        price_title: "Pricing",
        price_lead: "The demo teaches the concept. The subscription gives you <b>execution</b>: exactly what to do and when (no overwhelm) to stay consistent.",
        starter_title: "Starter",
        starter_tag: "Start now (without getting lost)",
        starter_1: "Broker recommendation + interactive guide to set up your brokerage account from zero",
        starter_2: "60-second monthly plan: exactly what to do this month to stay consistent",
        starter_3: "Monthly reminder (email) + templates (your one-page plan)",
        starter_4: "Anti-mistake support: fees, currency, and common errors when buying your first ETF",
        pay_btn: "Subscribe",
        premium_badge: "Premium",
        premium_title: "Personalized",
        premium_tag: "For “Aggressive” + more structure",
        premium_1: "Everything in Starter",
        premium_2: "Access to “Aggressive” (personalized portfolio)",
        premium_3: "Expanded monthly checklist (2 min) + risk control",
        premium_4: "Advanced simulator mode (goal + extra contributions)",
        premium_btn: "Go Premium",
        price_legal: "Transparency: we do not custody your money. You invest from your own broker. This is financial education.",
        footer_legal: "Disclaimer: educational content. Not financial advice. Past returns do not guarantee future results.",
        pay_stub: "Connect your payment (Stripe) here when you have it.",
        pay_stub_premium: "Connect your Premium payment (Stripe) here when you have it.",
        langTitle: "Choose language",
        langLead: "You can change it later at the top right.",
        langFoot: "Note: this site is educational. Not financial advice."
      },

      fr: {
        nav_guide: "Guide",
        plan_free: "Gratuit",
        plan_starter: "Starter",
        plan_premium: "Premium",
        plan_active: "Plan : ",
        guide_title: "Guide interactif (Starter)",
        guide_lead: "On te dit exactement comment démarrer de zéro : choisir un courtier, ouvrir le compte et acheter pour la première fois.",
        guide_locked_title: "Débloquer Starter",
        guide_locked_body: "La démo explique le concept. Starter te donne l’exécution : courtier recommandé + guide pas à pas + plan mensuel.",
        guide_locked_btn: "Voir Starter",
        guide_broker_title: "1) Courtier recommandé",
        guide_broker_body: "On recommande 1–2 courtiers selon ton pays (frais, ETF disponibles, simplicité).",
        guide_setup_title: "2) Configuration depuis 0",
        guide_setup_body: "Étapes interactives : compte, KYC, compte-titres et premiers virements.",
        guide_buy_title: "3) Premier achat",
        guide_buy_body: "Quel ETF acheter (selon stratégie), comment passer l’ordre, et quoi vérifier avant de confirmer.",
        guide_month_title: "4) Plan mensuel (60 secondes)",
        guide_month_body: "Chaque mois tu reçois un message court : se connecter, acheter, et ne rien faire d’autre.",
        guide_note: "Note : on ne garde pas ton argent et on n’exécute pas d’ordres. Tu investis via ton courtier.",
        risk_preview_note: "Aperçu : débloque “Risque élevé” avec Premium.",

        nav_plans: "Plans",
        brand_main: "Construis ton avenir",
        brand_sub: "avec moins que tu ne l’imagines",
        nav_compound: "Intérêt composé",
        nav_sim: "Simulateur",
        nav_pricing: "Abonnement",
        cta_sim: "Simuler",
        hero_pill: "⏳ 18–30 ans · Peu de capital · Beaucoup de temps",
        hero_h1: "Si tu n’as pas beaucoup d’argent, ton avantage est de commencer tôt.",
        hero_p: "Beaucoup de gens n’investissent pas parce qu’ils pensent que « 100 € par mois ne change rien ». En réalité, avec le <b>temps</b>, ces 100 € peuvent devenir beaucoup. Tu le verras clairement ici.",
        hero_btn: "Essayer le simulateur",
        hero_note: "Éducation financière. Nous ne touchons pas ton argent. Tu investis via ton propre courtier.",
        what_title: "Ce que nous faisons (simplement)",
        what_1_t: "On simplifie tout",
        what_1_d: "Stratégies simples (Global / États-Unis / Europe) avec des ETF à faible coût.",
        what_2_t: "Tu le vois en chiffres",
        what_2_d: "« Euros futurs » vs « euros d’aujourd’hui » pour comprendre l’inflation.",
        what_3_t: "Tu paies pour l’exécution",
        what_3_d: "Guide + plan mensuel + rappels pour ne pas abandonner.",
        comp_title: "L’intérêt composé en 30 secondes",
        comp_lead: "Tu gagnes de l’argent sur ton argent, puis aussi sur ce que tu as déjà gagné. C’est pour ça que ça démarre lentement… et accélère avec le temps.",
        comp_1_t: "1) Tu plantes la graine",
        comp_1_p: "Au début, c’est surtout toi qui verses. Ça paraît lent, mais tu construis la base.",
        comp_1_ex: "Si tu investis 100 €/mois :<br>après 1 an : 1 200 € versés",
        comp_2_t: "2) Le temps accélère",
        comp_2_p: "Avec les années, la croissance du marché pèse plus que tes versements.",
        comp_2_ex: "Année 5 : tes versements dominent<br>Année 25 : l’intérêt composé domine",
        comp_3_t: "3) Ton avantage : commencer",
        comp_3_p: "Si tu n’as pas un gros capital, tu ne joues pas avec l’argent. Tu joues avec le temps.",
        comp_3_ex: "Le plus dur : commencer.<br>Le plus rentable : être régulier.",
        comp_legal: "Nous utilisons des rendements moyens à long terme (modèle éducatif). Il y aura de bonnes et de mauvaises années.",

        // ✅ SNOWBALL keys
        snow_title: "Démo “boule de neige” (intérêt composé)",
        snow_lead: "Fais bouger les années : au début ça grandit lentement, puis ça accélère. C’est l’intérêt composé. Tu verras aussi “euros futurs” vs “euros d’aujourd’hui” (inflation).",
        snow_years_label: "Années",
        snow_monthly_label: "Versement mensuel",
        snow_rate_label: "Rendement annuel (éducatif)",
        snow_future: "Euros futurs",
        snow_today: "Euros d’aujourd’hui (inflation)",
        snow_note: "“Euros d’aujourd’hui” = pouvoir d’achat estimé avec une inflation fixe de 3%/an (juste pour comprendre).",

        sim_title: "Simulateur",
        sim_lead: "Ajuste ton âge et ton versement mensuel. Tu peux masquer les lignes en cliquant sur leur nom dans la légende.",
        age_label: "Âge actuel",
        ret_label: "Âge cible",
        monthly_label: "Versement mensuel ({CUR})",
        initial_label: "Versement initial ({CUR}) (optionnel)",
        strategy_label: "Stratégie",
        opt_global: "Conservateur — Global",
        opt_usa: "Modéré — États-Unis",
        opt_eu: "Modéré — Europe",
        opt_risk: "Risque élevé — Portefeuille personnalisé (Premium)",
        lock_b: "Risque élevé (Premium) :",
        lock_t: "cette option est prévue pour Premium avec portefeuille personnalisé. En démo, on utilise une hypothèse “élevée” pour visualiser (sans promesse).",
        lock_btn: "Voir Premium",
        btn_sim: "Simuler",
        btn_reset: "Réinitialiser",
        res_nom_label: "Résultat final (euros futurs)",
        res_real_label: "Résultat final (euros d’aujourd’hui)",
        infl_note: "Inflation supposée : 3% / an",
        sav_nom_label: "Épargne totale (tes versements)",
        sav_nom_sub: "Sans investissement (uniquement versements)",
        sav_real_label: "Épargne totale (euros d’aujourd’hui)",
        sav_real_sub: "Pouvoir d’achat estimé à prix d’aujourd’hui",
        read_title: "Comment lire le graphique",
        read_1: "<b>Euros futurs</b> : grand chiffre en année X (l’argent vaudra moins).",
        read_2: "<b>Euros d’aujourd’hui</b> : estimation du <b>pouvoir d’achat</b> à prix actuels.",
        read_3: "<b>Épargne</b> : ce que tu verses. Ça montre ce qui vient du marché.",
        read_4: "Astuce : regarde l’écart entre <b>Investissement</b> et <b>Épargne</b> : c’est l’intérêt composé.",
        sim_disclaimer: "* Simulation éducative (modèle simplifié). Investir comporte des risques. Les performances passées ne garantissent pas les performances futures.",
        chart_title: "Évolution (tu peux masquer des lignes)",
        chart_hint: "Clique sur un nom : masquer / afficher",
        k1: "Investissement (euros futurs)",
        k2: "Investissement (euros d’aujourd’hui)",
        k3: "Épargne (euros futurs)",
        k4: "Épargne (euros d’aujourd’hui)",
        price_title: "Abonnement",
        price_lead: "La démo explique le concept. L’abonnement te donne <b>l’exécution</b> : quoi faire et quand, sans te compliquer.",
        starter_title: "Starter",
        starter_tag: "Pour commencer maintenant",
        starter_1: "Recommandation de courtier + guide interactif pour créer ton compte",
        starter_2: "Plan mensuel de 60 secondes : quoi faire ce mois-ci",
        starter_3: "Rappel mensuel (email) + modèles (plan 1 page)",
        starter_4: "Support anti-erreurs : frais, devise, erreurs courantes",
        pay_btn: "S’abonner",
        premium_badge: "Premium",
        premium_title: "Personnalisé",
        premium_tag: "Pour une stratégie plus risquée + structure",
        premium_1: "Tout ce qui est inclus dans Starter",
        premium_2: "Accès à “Risque élevé” (portefeuille personnalisé)",
        premium_3: "Plan mensuel avancé (2 min) + contrôle du risque",
        premium_4: "Mode avancé du simulateur (objectif + versements)",
        premium_btn: "Passer en Premium",
        price_legal: "Transparence : nous ne détenons pas ton argent. Tu investis via ton propre courtier. Ceci est de l’éducation financière.",
        footer_legal: "Avertissement : contenu éducatif. Pas un conseil financier. Les performances passées ne garantissent pas les performances futures.",
        pay_stub: "Tu brancheras le paiement (Stripe) ici quand tu l’auras.",
        pay_stub_premium: "Tu brancheras le paiement Premium (Stripe) ici quand tu l’auras.",
        langTitle: "Choisis la langue",
        langLead: "Tu peux changer plus tard en haut à droite.",
        langFoot: "Site éducatif. Pas de conseil financier."
      },

      da: {
        nav_guide: "Guide",
        plan_free: "Gratis",
        plan_starter: "Starter",
        plan_premium: "Premium",
        plan_active: "Plan: ",
        guide_title: "Interaktiv guide (Starter)",
        guide_lead: "Vi fortæller dig præcis hvordan du starter fra 0: vælg broker, opret konto og køb første gang.",
        guide_locked_title: "Lås Starter op",
        guide_locked_body: "Demoen lærer dig konceptet. Starter giver eksekvering: broker-anbefaling + trin-for-trin guide + månedsplan.",
        guide_locked_btn: "Se Starter",
        guide_broker_title: "1) Broker-anbefaling",
        guide_broker_body: "Vi anbefaler 1–2 brokers efter dit land (gebyrer, ETF-udvalg og enkelhed).",
        guide_setup_title: "2) Opsætning fra 0",
        guide_setup_body: "Interaktive trin: konto, KYC, investeringskonto og første overførsel.",
        guide_buy_title: "3) Dit første køb",
        guide_buy_body: "Hvilken ETF du køber (strategi), hvordan du lægger ordren, og hvad du tjekker før du godkender.",
        guide_month_title: "4) Månedsplan (60 sek.)",
        guide_month_body: "Hver måned får du en kort besked: log ind, køb, og gør ikke mere.",
        guide_note: "Note: vi opbevarer ikke dine penge og udfører ikke ordrer. Du investerer via din egen broker.",
        risk_preview_note: "Preview: lås høj risiko op med Premium.",

        nav_plans: "Planer",
        brand_main: "Byg din fremtid",
        brand_sub: "med mindre end du tror",
        nav_compound: "Rentes rente",
        nav_sim: "Simulator",
        nav_pricing: "Abonnement",
        cta_sim: "Simulér nu",
        hero_pill: "⏳ 18–30 år · Lidt kapital · Meget tid",
        hero_h1: "Hvis du ikke har mange penge, er din fordel at starte tidligt.",
        hero_p: "Mange investerer ikke, fordi de tror “700kr om måneden gør ingen forskel”. Virkeligheden: med <b>tid</b> kan 700kr blive til meget. Det ser du tydeligt i simuleringen.",
        hero_btn: "Prøv simulatoren",
        hero_note: "Finansiel læring. Vi rører ikke dine penge. Du investerer via din egen broker.",
        what_title: "Hvad vi gør (uden jargon)",
        what_1_t: "Vi gør det enkelt",
        what_1_d: "Simple strategier (Global / USA / Europa) med billige ETF’er.",
        what_2_t: "Du ser det i tal",
        what_2_d: "“Fremtidige euro” vs “euro i dag” for at forstå inflation.",
        what_3_t: "Du betaler for eksekvering",
        what_3_d: "Guide + tjekliste + månedlig reminder, så du ikke stopper.",
        comp_title: "Rentes rente på 30 sekunder",
        comp_lead: "Enkelt: du tjener penge på dine penge — og over tid tjener du også på det, du allerede har tjent. Derfor ser væksten langsom ud i starten… og accelererer senere.",
        comp_1_t: "1) Du planter frøet",
        comp_1_p: "I starten er det mest dine egne indbetalinger. Det virker langsomt, men du bygger fundamentet.",
        comp_1_ex: "Hvis du investerer €100/måned:<br>efter 1 år: €1.200 indbetalt",
        comp_2_t: "2) Tid gør forskellen",
        comp_2_p: "Efterhånden begynder markedsvækst at fylde mere end dine indbetalinger.",
        comp_2_ex: "År 5: dine indbetalinger dominerer<br>År 25: rentes rente dominerer",
        comp_3_t: "3) Din fordel er at starte",
        comp_3_p: "Hvis du ikke har stor kapital, konkurrerer du ikke med penge. Du konkurrerer med tiden.",
        comp_3_ex: "Sværest: at starte.<br>Mest profitabelt: at være konsekvent.",
        comp_legal: "Vi bruger langsigtede gennemsnitsafkast (uddannelsesmodel). Der kommer både gode og dårlige år.",

        // ✅ SNOWBALL keys
        snow_title: "“Snebold” demo (rentes rente)",
        snow_lead: "Flyt årene: den vokser langsomt i starten, og så accelererer den. Det er rentes rente. Du ser også “fremtidige euro” vs “euro i dag” (inflation).",
        snow_years_label: "År",
        snow_monthly_label: "Månedlig indbetaling",
        snow_rate_label: "Årligt afkast (uddannelse)",
        snow_future: "Fremtidige euro",
        snow_today: "Euro i dag (inflation)",
        snow_note: "“Euro i dag” = estimeret købekraft med fast 3% inflation pr. år (kun for at forstå konceptet).",

        sim_title: "Simulator",
        sim_lead: "Vælg alder og månedligt beløb. Du ser 4 linjer: investering (fremtidige euro), investering (euro i dag), opsparing (fremtidige euro) og opsparing (euro i dag). <b>Du kan skjule linjer</b> ved at klikke på navnet i legenden.",
        age_label: "Nuværende alder",
        ret_label: "Mål-alder",
        monthly_label: "Månedlig indbetaling ({CUR})",
        initial_label: "Startbeløb ({CUR}) (valgfrit)",
        strategy_label: "Strategi",
        opt_global: "Konservativ — Global",
        opt_usa: "Moderat — USA",
        opt_eu: "Moderat — Europa",
        opt_risk: "Høj risiko — Personlig portefølje (Premium)",
        lock_b: "Høj risiko (Premium):",
        lock_t: "denne mulighed er til Premium med personlig portefølje. I demoen bruger vi en “høj” antagelse for at visualisere (ikke et løfte).",
        lock_btn: "Se Premium",
        btn_sim: "Simulér",
        btn_reset: "Nulstil",
        res_nom_label: "Slutresultat (fremtidige euro)",
        res_real_label: "Slutresultat (euro i dag)",
        infl_note: "Antaget inflation: 3% pr. år",
        sav_nom_label: "Samlet opsparing (det du indbetaler)",
        sav_nom_sub: "Ingen investering (kun indbetalinger)",
        sav_real_label: "Samlet opsparing (euro i dag)",
        sav_real_sub: "Estimeret købekraft i dagens priser",
        read_title: "Sådan læser du grafen (klart)",
        read_1: "<b>Fremtidige euro</b>: det store tal i år X. Lyder enormt, men pengene er mindre værd.",
        read_2: "<b>Euro i dag</b>: estimeret <b>købekraft</b> (hvad det svarer til i dagens priser).",
        read_3: "<b>Opsparing</b>: det du selv indbetaler. Viser hvor meget der kommer fra markedet.",
        read_4: "Tip: kig på forskellen mellem <b>Investering</b> og <b>Opsparing</b>. Det er rentes rente.",
        sim_disclaimer: "* Uddannelsessimulation (forenklet model). Investering indebærer risiko. Historisk afkast garanterer ikke fremtidigt afkast.",
        chart_title: "Udvikling (skjul linjer i legenden)",
        chart_hint: "Klik på et navn: skjul / vis",
        k1: "Investering (fremtidige euro)",
        k2: "Investering (euro i dag)",
        k3: "Opsparing (fremtidige euro)",
        k4: "Opsparing (euro i dag)",
        price_title: "Abonnement",
        price_lead: "Demoen lærer dig konceptet. Abonnementet giver <b>eksekvering</b>: præcis hvad du gør og hvornår (uden stress) for at holde fast.",
        starter_title: "Starter",
        starter_tag: "Kom i gang (uden at fare vild)",
        starter_1: "Broker-anbefaling + interaktiv guide til at oprette din investeringskonto fra 0",
        starter_2: "60-sekunders månedsplan: præcis hvad du gør denne måned for at være konsekvent",
        starter_3: "Månedlig reminder (email) + skabeloner (din 1-sides plan)",
        starter_4: "Anti-fejl support: gebyrer, valuta og typiske fejl når du køber din første ETF",
        pay_btn: "Tilmeld",
        premium_badge: "Premium",
        premium_title: "Personlig",
        premium_tag: "For “høj risiko” + mere struktur",
        premium_1: "Alt i Starter",
        premium_2: "Adgang til “høj risiko” (personlig portefølje)",
        premium_3: "Udvidet månedlig tjekliste (2 min) + risikokontrol",
        premium_4: "Avanceret simulator (mål + ekstra indbetalinger)",
        premium_btn: "Gå Premium",
        price_legal: "Transparens: vi opbevarer ikke dine penge. Du investerer via din egen broker. Dette er finansiel læring.",
        footer_legal: "Ansvarsfraskrivelse: uddannelsesindhold. Ikke finansiel rådgivning. Historisk afkast garanterer ikke fremtidigt afkast.",
        pay_stub: "Tilføj betaling (Stripe) her, når du har den.",
        pay_stub_premium: "Tilføj Premium-betaling (Stripe) her, når du har den.",
        langTitle: "Vælg sprog",
        langLead: "Du kan ændre det senere øverst til højre.",
        langFoot: "Bemærk: siden er uddannelsesbaseret. Ikke finansiel rådgivning."
      }
    };

    let currentLang = "es";

function getPlan(){
  // plan real guardado al hacer login/dashboard
  return (localStorage.getItem("ctf_plan") || "free").toLowerCase();
}

// ✅ pago real: Stripe
async function buyPlan(plan) {
  const API_BASE = "https://construye-tu-futuro.onrender.com";

  const currency = currentLang === "da" ? "dkk" : "eur";

  try {
    const res = await fetch(`${API_BASE}/create-checkout-session`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ plan, currency }),
    });

    const data = await res.json().catch(() => ({}));

    if (!res.ok) {
      alert(data.error || "Error creando sesión de Stripe");
      return;
    }

    window.location.href = data.url;
  } catch (e) {
    console.error(e);
    alert("Error de red. Mira consola y logs del backend.");
  }
}
    function planLabel(plan){
      const d = i18n[currentLang] || i18n.es;
      if (plan === "premium") return d.plan_premium;
      if (plan === "starter") return d.plan_starter;
      return d.plan_free;
    }
    function updateLocks(){
      const plan = getPlan();
      const d = i18n[currentLang] || i18n.es;
      const pill = document.getElementById("planPill");
      if (pill){
      // ya no mostramos "Plan: X", ahora es un botón fijo que baja a #precios
      pill.style.display = "inline-flex";
      }
      
      const lock = document.getElementById("guideLock");
      const content = document.getElementById("guideContent");
      if (lock && content){
        const unlocked = (plan === "starter" || plan === "premium");
        lock.style.display = unlocked ? "none" : "block";
        content.style.opacity = unlocked ? "1" : "0.35";
        content.style.pointerEvents = unlocked ? "auto" : "none";
        content.style.filter = unlocked ? "none" : "blur(1px)";
      }
    }

    // ----- Utilities -----
// ----- Utilities -----
function getCurrency(){
  return currentLang === "da" ? "DKK" : "EUR";
}

function fmtMoneyLocal(n){
  const cur = getCurrency();
  const locale =
    currentLang === "da" ? "da-DK" :
    currentLang === "en" ? "en-GB" :
    currentLang === "fr" ? "fr-FR" : "es-ES";

  const abs = Math.abs(Number(n) || 0);

  // ✅ precisión adaptativa:
  // - < 10.000 => 2 decimales
  // - 10.000 a 1.000.000 => 0 decimales
  // - >= 1.000.000 => 0 decimales (igual)
  const digits = abs < 10000 ? 2 : 0;

  return new Intl.NumberFormat(locale, {
    style: "currency",
    currency: cur,
    minimumFractionDigits: digits,
    maximumFractionDigits: digits
  }).format(n);
}

const fmtMoney = (n) => fmtMoneyLocal(n);

function fillAgeSelect(selectEl, min, max, selected){
      selectEl.innerHTML = "";
      for(let a=min; a<=max; a++){
        const opt = document.createElement("option");
        opt.value = String(a);
        opt.textContent = String(a);
        if (a === selected) opt.selected = true;
        selectEl.appendChild(opt);
      }
    }

    function savingsReal(initial, annualContrib, years){
      let s = initial;
      for(let i=1;i<=years;i++){
        s += annualContrib / Math.pow(1+INFLATION, i);
      }
      return s;
    }

   function buildSeriesMonthly(age, retAge, monthly, initial, annualRate){
  const years = retAge - age;
  const months = years * 12;
  const i = annualRate / 12;

  const labels = [];
  const invNom = [];
  const invReal = [];
  const savNom = [];
  const savReal = [];

  let v = initial;
  let s = initial;

  for (let m=1; m<=months; m++){
    // inversión (nominal)
    v = v * (1 + i) + monthly;

    // ahorro (nominal) = solo aportes
    s += monthly;

    // al final de cada año guardamos punto
    if (m % 12 === 0){
      const y = m / 12;
      labels.push(age + y);

      const def = Math.pow(1 + INFLATION, y);

      invNom.push(v);
      invReal.push(v / def);

      savNom.push(s);
      savReal.push(s / def);
    }
  }

  return { years, labels, invNom, invReal, savNom, savReal };
}

    function updatePriceLabels(lang){
      const p5 = document.getElementById("price5");
      const p9 = document.getElementById("price9");
      if (!p5 || !p9) return;
      if (lang === "en"){
        p5.textContent = "€5 / month";
        p9.textContent = "€9 / month";
      } else if (lang === "da"){
        p5.textContent = "40 kr / måned";
        p9.textContent = "70 kr / måned";
      } else if (lang === "fr"){
        p5.textContent = "5 € / mois";
        p9.textContent = "9 € / mois";
      } else {
        p5.textContent = "5€ / mes";
        p9.textContent = "9€ / mes";
      }
    }

    function applyI18n(lang){
      document.documentElement.lang = lang;
      const dict = i18n[lang] || i18n.es;

      document.getElementById("langTitle").textContent = dict.langTitle;
      document.getElementById("langLead").textContent  = dict.langLead;
      document.getElementById("langFoot").textContent  = dict.langFoot;
      updatePriceLabels(lang);

      document.querySelectorAll("[data-i18n]").forEach(el => {
        const key = el.getAttribute("data-i18n");
        if (!key) return;
        const valRaw = dict[key];
        if (valRaw == null) return;
        const cur = (lang === "da") ? "DKK" : "EUR";
        const val = String(valRaw).replaceAll("{CUR}", cur);

        if (val.includes("<") && (el.tagName === "P" || el.tagName === "DIV" || el.tagName === "LI" || el.tagName === "SPAN")) {
          el.innerHTML = val;
        } else {
          el.textContent = val;
        }
      });

      const sel = document.getElementById("portfolio");
      Array.from(sel.options).forEach(opt => {
        const k = opt.getAttribute("data-i18n");
        if (k && dict[k]) opt.textContent = dict[k];
      });

      simulate();
    }

    window.setLang = (lang, fromOverlay=false) => {
      currentLang = lang;

      if (lang === "da") {
        const m = document.getElementById("monthly");
        const v = parseFloat(m.value || "0");
        if (!v || v === 100) m.value = 500;
      }

      localStorage.setItem("lang", lang);
      document.getElementById("langSelect").value = lang;

      const monthlyEl = document.getElementById("monthly");
      if (lang === "da") {
        const current = parseFloat(monthlyEl.value || "0");
        if (current === 100) monthlyEl.value = 500;
      }

      applyI18n(lang);
      if (fromOverlay){
        document.getElementById("langOverlay").style.display = "none";
      }
      updateSnowball(); // ✅ keep snowball formatted
    };

    // ✅ Snowball function (missing before)
    function updateSnowball(){
      const y = parseInt(document.getElementById("snowYears").value, 10);
      const m = Math.max(0, parseFloat(document.getElementById("snowMonthly").value || "0"));
      const r = Math.max(0, parseFloat(document.getElementById("snowRate").value || "0")) / 100;

      const pill = document.getElementById("snowYearsPill");
      if (pill) pill.textContent = String(y);

      const i = r / 12;
      const n = y * 12;

      let fv = 0;
      if (i === 0){
        fv = m * n;
      } else {
        fv = m * ((Math.pow(1+i, n) - 1) / i);
      }

      const real = fv / Math.pow(1 + INFLATION, y);

      const snowNom = document.getElementById("snowNom");
      const snowReal = document.getElementById("snowReal");
    if (snowNom) snowNom.textContent = fmtMoneyLocal(fv);
    if (snowReal) snowReal.textContent = fmtMoneyLocal(real);

const ball = document.getElementById("snowBall");
const stage = document.getElementById("snowStage");
if (ball && stage){
  // progreso 0..1
  const t = (y - 1) / (45 - 1);

  // tamaño (suave, se acelera al final)
  const minS = 44, maxS = 170;
  const size = minS + (maxS - minS) * Math.pow(t, 0.7);

  // medidas del escenario
  const W = stage.clientWidth;
  const H = stage.clientHeight;

  // La pendiente va aprox de (5%, 28%) a (85%, 75%)
  const startX = 0.05, endX = 0.85;
  const startY = 0.28, endY = 0.75;

  // posición ideal
  const xIdeal = (startX + (endX - startX) * t) * W;
  const yIdeal = (startY + (endY - startY) * t) * H;

  // CLAMP: para que la bola no se recorte por overflow:hidden en móvil
  const pad = size * 0.55; // margen aprox por translate(-50%)
  const x = Math.min(Math.max(xIdeal, pad), W - pad);
  const yPos = Math.min(Math.max(yIdeal, pad), H - pad);

  // rotación realista: gira según la distancia recorrida
  const startPx = startX * W;
  const startPy = startY * H;
  const dist = Math.hypot(x - startPx, yPos - startPy);
  const circumference = Math.PI * size;
  const turns = dist / Math.max(1, circumference);
  const rot = turns * 360;

  ball.style.width = `${size}px`;
  ball.style.height = `${size}px`;
  ball.style.left = `${x}px`;
  ball.style.top = `${yPos}px`;
  ball.style.transform = `translate(-50%, -50%) rotate(${rot}deg)`;
}
    }

    let chart;

    function simulate(){
const age = parseInt(document.getElementById("age").value, 10);
const retAge = parseInt(document.getElementById("retAge").value, 10);
const monthly = Math.max(0, parseFloat(document.getElementById("monthly").value || "0"));
const initial = Math.max(0, parseFloat(document.getElementById("initial").value || "0"));
const key = document.getElementById("portfolio").value;

let p = PORTFOLIOS[key];
const plan = getPlan();

const isPreviewRisk = (key === "risk" && plan !== "premium");
const shownNominal = isPreviewRisk ? PORTFOLIOS.usa.nominal : p.nominal;
if (isPreviewRisk){
  // en demo, si no tienes premium, lo hacemos igual que USA para que no “prometa” más
  p = { ...p, nominal: PORTFOLIOS.usa.nominal, premium:true };
}

const dict = i18n[currentLang] || i18n.es;

if (retAge <= age){
  alert(currentLang === "en" ? "Target age must be higher than current age." :
        currentLang === "da" ? "Mål-alderen skal være højere end nuværende alder." :
        "La edad objetivo debe ser mayor que la edad actual.");
  return;
}

// lock premium box
document.getElementById("premiumLock").style.display = (key === "risk") ? "block" : "none";
if (key === "risk" && plan !== "premium"){
  document.getElementById("premiumLock").querySelector("span").innerHTML = i18n[currentLang].risk_preview_note;
} else if (key === "risk" && plan === "premium"){
  document.getElementById("premiumLock").querySelector("span").innerHTML = i18n[currentLang].lock_t || "";
}

// nota tasas: ahora “euros de hoy” viene por inflación, no por otra tasa
const strategyName = dict[p.nameKey] || "";
document.getElementById("ratesNote").innerHTML =
  `<b>${currentLang==="en"?"Educational assumption":(currentLang==="da"?"Uddannelsesantagelse":(currentLang==="fr"?"Hypothèse éducative":"Supuesto educativo"))}:</b> ${strategyName}. 
  <span style="font-family:var(--mono)">${Math.round(shownNominal*100)}% nominal</span>.
  ${currentLang==="en"?"Inflation assumed":(currentLang==="da"?"Antaget inflation":(currentLang==="fr"?"Inflation supposée":"Inflación asumida"))}: 
  <span style="font-family:var(--mono)">3%/${currentLang==="da"?"år":(currentLang==="es"?"año":(currentLang==="fr"?"an":"year"))}</span>.`;

const S = buildSeriesMonthly(age, retAge, monthly, initial, p.nominal);

const years = S.years;
const finalNom = S.invNom[S.invNom.length - 1] ?? 0;
const finalReal = S.invReal[S.invReal.length - 1] ?? 0;

const totalSavingsNom = initial + monthly * 12 * years;
const totalSavingsReal = savingsRealMonthly(initial, monthly, years);
function savingsRealMonthly(initial, monthly, years){
  const months = years * 12;
  let s = initial; // valor en euros de hoy
  for (let m = 1; m <= months; m++){
    const tYears = m / 12;
    s += monthly / Math.pow(1 + INFLATION, tYears);
  }
  return s;
}
document.getElementById("resNominal").textContent = fmtMoney(finalNom);
document.getElementById("resReal").textContent = fmtMoney(finalReal);
document.getElementById("resSaveNom").textContent = fmtMoney(totalSavingsNom);
document.getElementById("resSaveReal").textContent = fmtMoney(totalSavingsReal);

const horizonText = currentLang==="en"
  ? `${years} years · You invest ${fmtMoney(monthly)} / month`
  : currentLang==="da"
    ? `${years} år · Du investerer ${fmtMoney(monthly)} / måned`
    : `${years} años · Aportas ${fmtMoney(monthly)} / mes`;
document.getElementById("resHorizon").textContent = horizonText;

// chart
const ctx = document.getElementById("chart");
if(chart) chart.destroy();

chart = new Chart(ctx, {
  type: "line",
  data: {
    labels: S.labels,
    datasets: [
      { label: dict.k1, data: S.invNom.map(x=>Math.round(x)), tension:0.15, borderWidth:3, pointRadius:0, borderColor: SERIES_COLORS.invNom },
      { label: dict.k2, data: S.invReal.map(x=>Math.round(x)), tension:0.15, borderWidth:3, pointRadius:0, borderColor: SERIES_COLORS.invReal },
      { label: dict.k3, data: S.savNom.map(x=>Math.round(x)), tension:0.05, borderWidth:3, pointRadius:0, borderColor: SERIES_COLORS.savNom },
      { label: dict.k4, data: S.savReal.map(x=>Math.round(x)), tension:0.05, borderWidth:3, pointRadius:0, borderColor: SERIES_COLORS.savReal }
    ]
  },
  options: {
    responsive: true,
    maintainAspectRatio: false,
    interaction: { mode:"index", intersect:false },
    plugins: {
      legend: { position:"bottom" },
      tooltip: { callbacks: { label: (c)=> `${c.dataset.label}: ${fmtMoney(c.parsed.y)}` } }
    },
scales: {
  y: {
    type: "linear",
    beginAtZero: true,
    ticks: {
      callback: (v) => {
        const n = Number(v);
        const cur = getCurrency();
        const isDKK = cur === "DKK";
        const M = isDKK ? "Mkr" : "M€";
        const K = isDKK ? "kkr" : "k€";
        const U = isDKK ? "kr"  : "€";
        if (Math.abs(n) >= 1_000_000) return (n/1_000_000).toFixed(1) + M;
        if (Math.abs(n) >= 1_000) return (n/1_000).toFixed(0) + K;
        return n + U;
      }
    }
  },
  x: { ticks: { maxTicksLimit: 10 } }
}
  }
});

updateSnowball();
      // keep snowball aligned with language formatting
    }

    function resetForm(){
      document.getElementById("monthly").value = 100;
      document.getElementById("initial").value = 0;
      document.getElementById("portfolio").value = "global";
      document.getElementById("age").value = "20";
      document.getElementById("retAge").value = "67";
      simulate();
    }

    // Init selects
    const ageSel = document.getElementById("age");
    const retSel = document.getElementById("retAge");
    fillAgeSelect(ageSel, 18, 99, 20);
    fillAgeSelect(retSel, 18, 99, 67);

    ageSel.addEventListener("change", () => {
      const a = parseInt(ageSel.value,10);
      const r = parseInt(retSel.value,10);
      if (r <= a) retSel.value = String(Math.min(99, a + 1));
      simulate();
    });
    retSel.addEventListener("change", () => simulate());
    document.getElementById("portfolio").addEventListener("change", () => simulate());
    document.getElementById("btnSim").addEventListener("click", simulate);
    document.getElementById("btnReset").addEventListener("click", resetForm);

    // Language handling
    document.getElementById("langSelect").addEventListener("change", (e) => setLang(e.target.value, false));

    // boot
    document.getElementById("year").textContent = new Date().getFullYear();

    const saved = localStorage.getItem("lang");
    if (saved && i18n[saved]) {
      currentLang = saved;
      if (saved === "da") {
        const m = document.getElementById("monthly");
        const v = parseFloat(m.value || "0");
        if (!v || v === 100) m.value = 500;
      }

      document.getElementById("langSelect").value = saved;
      document.getElementById("langOverlay").style.display = "none";
      applyI18n(saved);
      updateLocks();
    } else {
      currentLang = "es";
      document.getElementById("langSelect").value = "es";
      applyI18n("es");
      updateLocks();
    }

    (function handleStripeReturn(){
  const qs = new URLSearchParams(window.location.search);
  const success = qs.get("success");
  const plan = qs.get("plan");
  if(success === "1" && plan){
    // OJO: esto NO valida acceso, solo actualiza UI rápido.
    // La validación real la hace /dashboard.html llamando al backend.
    localStorage.setItem("ctf_plan", plan.toLowerCase());
    updateLocks();

    // limpia URL para que no quede fea
    const clean = window.location.pathname + window.location.hash;
    window.history.replaceState({}, "", clean);
  }
})();
    // ✅ Snowball boot
    const snowYears = document.getElementById("snowYears");
    const snowMonthly = document.getElementById("snowMonthly");
    const snowRate = document.getElementById("snowRate");
    if (snowYears && snowMonthly && snowRate){
      snowYears.addEventListener("input", updateSnowball);
      snowMonthly.addEventListener("input", updateSnowball);
      snowRate.addEventListener("input", updateSnowball);
      updateSnowball();
    }
  </script>
</body>
</html>
